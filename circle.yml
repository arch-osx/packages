machine:
    xcode:
        version: 8.3.3
dependencies:
    pre:
        - sudo mkdir -p /opt
        - sed -i~ -e '/^# Homebrew alternate path/ {N;N;d;}' ~/.bashrc
        - sed -i~ -e '/^# Homebrew alternate path/ {N;N;d;}' ~/.bash_profile
        - sed -i~ -e '/^# chruby hooks/ {N;N;N;d;}' ~/.bashrc
        - sed -i~ -e '/^# chruby hooks/ {N;N;N;d;}' ~/.bash_profile
        - sudo rm -rf /usr/local/*
        - sudo rm -rf /opt/*
        - curl -O http://download.arch-osx.org/snapshots/arch-osx-snapshot.tar.gz
        - sudo tar -C / -xvpzf arch-osx-snapshot.tar.gz
        - echo 'export PATH="/opt/arch/bin:/opt/arch/sbin:$PATH"' >> ~/.bashrc
        - echo 'export PATH="/opt/arch/bin:/opt/arch/sbin:$PATH"' >> ~/.bash_profile
        - sudo sed -i~ -e 's/^#Server/Server/' /opt/arch/etc/pacman.d/mirrorlist
    override:
        - sudo pacman --sync --refresh --noprogressbar
        - sudo pacman --sync --sysupgrade --noprogressbar --noconfirm --downloadonly
        - sudo pacman --sync --sysupgrade --noprogressbar --noconfirm
database:
    override:
        - /usr/bin/true
compile:
    override:
        - .support/build $(.support/changes master "${CIRCLE_SHA1}")
test:
    override:
        - /usr/bin/true
